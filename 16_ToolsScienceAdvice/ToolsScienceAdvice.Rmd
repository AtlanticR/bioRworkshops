---
title: "Interactive Tools for Science Advice Workshop"
output: 
  flexdashboard::flex_dashboard:
    source_code: embed
---

```{r setup, include=FALSE}
library(plotly)
library(crosstalk)
library(ggplot2)
library(DT)
library(leaflet)
rv <- read.csv("RV2010_2018_trim.csv")
rv <- rv[which(rv$SPEC %in% c(10, 30, 2550)), ]
rv$COMM <- factor(rv$COMM)
shared_rv <- SharedData$new(rv)
```

Workshop {data-icon="fa-laptop"}
=======================================

Column {.tabset}
---------------------------------------

### Executive Summary

<div style="float: left; width: 19%; padding-right: 1%;">


```{r, out.width = "100%"}
knitr::include_graphics("stickers-fish.jpg")
```

</div>  
    
<div style="float: right; width: 80%;">

**November 5, 2019, at BIO**  

Workshop led by Dr. Paul Regular, DFO, Newfoundland and Labrador region  

#### Abstract

In the age of big data, scientists across many fields are faced with the challenge of synthesizing and communicating information from large and complex data sets. This growth in data, alongside the computational methods used to integrate it, can make the process of communicating the results to stakeholders and managers in a meaningful way more daunting. The traditional approach of presenting information across a series of static slides and plots often fails to convey the richness of information available and, as such, important patterns and details are easily overlooked. 

Dr. Paul Regular and his co-workers in Newfoundland and Labrador region contend that this problem can be mediated through the effective use of new open source tools for building interactive visualizations (e.g. R packages such as `flexdashboard`, `shiny` and `plotly`). These tools allow a broader audience to conduct detailed explorations of the results, leading to a deeper and collective understanding of both the data and models used to inform Science advice. As a consequence, the peer review process is more open and accessible and the resulting science advice is improved and widely supported.

#### Outcome of the workshop

This workshop enabled us to learn about the use of interactive tools, its role in supporting Science advice, and a discussion of a path-forward to extend this to other approaches in DFO. 

This dashboard was created by Paul Regular and Catalina Gomez following the workshop to share resources and tools available at our fingertips. 

</div>

### Getting Started 


**Stock assessment output dashboard in R**  
by Paul Regular

Step 1:
Download the *getting started dashboard* to your machine (and use google chrome to visualize this html): https://drive.google.com/file/d/1Nttg8aYjVJLtg_9ndDYnS131pycNbfsh/view?usp=sharing


Step 2: Watch the TESA webinar: https://www.gcpedia.gc.ca/wiki/DFO_Science_TESA_ETES


Step 3: Watch the BIO seminar: https://drive.google.com/file/d/1XHLmOl6gV4kY5_0STdk42vTarkFI0VzR/view?usp=sharing


Step 4: Explore this dashboard to learn about the workshop.

### Proposal
<br>
<br>
This workshop was developed and proposed to promote learning and development relevant for staff in OESD, CESD, SPAD and PED at BIO. Full proposal was submitted in July 2019 and is accesible here:  

https://docs.google.com/document/d/1uMrd_UhAEI9R4wZ0bFQeYr6ZVFqTe4MA/edit

### Agenda
<br>
<br>
Agenda for workshop on November 5th 2019 distributed to workshop participants:  

https://docs.google.com/spreadsheets/d/1rWqus06dRR5TQfTOwpfq9Ul862BvzZ7rG5qXJOSuC-s/edit#gid=0

### Code repo for this flashboard (a.k.a. workshop challenge)
<br>
<br>
The full repository to create this flashboard is in the Atlantic R GitHub site:

https://github.com/AtlanticR/bioRworkshops/tree/master/16_ToolsScienceAdvice

### Pre-workshop material
<br>
<br>

**Intro to Shiny Apps**  
by Chantelle Layton & Clark Richards  
recoding - use Internet explorer: https://drive.google.com/file/d/1lk-gNbqdhpXEJKNaljfqI1oZFVev2i-L/view  
code repo: https://github.com/AtlanticR/bioRworkshops/tree/master/14_Shiny_intro

### Post-workshop survey results
<br>
<br>
Comming soon!

Map {data-icon="fa-map"}
=======================================

Column {.sidebar}
-------------------------------------

### Inputs

```{r}

filter_select("MISSION", "Mission", shared_rv, ~MISSION)
filter_select("COMM", "Species", shared_rv, ~COMM)

```


Column {.tabset}
-------------------------------------

### Map connected to filters

```{r}

p <- plot_geo(data = shared_rv, x = ~LONGITUDE, y = ~LATITUDE, color = ~COMM,
              size = ~TOTWGT, sizes = c(10, 500),
              colors = viridis::viridis(3)) %>%  
  add_markers() %>%                                       
  layout(geo = list(resolution = 50,                      
                    showland = TRUE,                      
                    landcolor = toRGB("grey90"),          
                    coastlinecolor = toRGB("grey80"),
                    projection = list(type = "mercator"),    
                    lonaxis = list(range = c(-75, -45)),    
                    lataxis = list(range = c(40, 50))))
p
```

### Leaflet map

```{r}

leaflet(shared_rv) %>%
  addTiles() %>%
  addCircleMarkers(stroke = FALSE,
                   fillOpacity = 0.5, radius = 3,
                   color = ~viridis::viridis(3)[factor(COMM)])

```


### Animated map using the plotly frame argument

```{r}

p <- plot_geo(data = rv, x = ~LONGITUDE, y = ~LATITUDE, color = ~COMM,
              frame = ~YEAR, size = ~TOTWGT, sizes = c(10, 500),
              colors = viridis::viridis(3)) %>%  
  add_markers() %>%                                       
  layout(geo = list(resolution = 50,                      
                    showland = TRUE,                      
                    landcolor = toRGB("grey90"),          
                    coastlinecolor = toRGB("grey80"),
                    projection = list(type = "mercator"),    
                    lonaxis = list(range = c(-75, -45)),    
                    lataxis = list(range = c(40, 50)))) %>% 
  highlight(persisten = TRUE, off = "plotly_relayout")
p
```


Plots {data-icon="fa-signal"}
=======================================

Column
-------------------------------------

### Temperature

```{r}
plot_ly(data = shared_rv) %>% 
  add_markers(x = ~BOTTOM_TEMPERATURE, y = ~SURFACE_TEMPERATURE,
              color = ~COMM, colors = viridis::viridis(3),
              size = ~TOTWGT, sizes = c(10, 500)) %>% 
  highlight(persisten = TRUE, off = "plotly_relayout")

```

> Markers sized based on total weight captured


Data {data-icon="fa-database"}
=======================================

Column
-------------------------------------

### Results

```{r}
DT::datatable(shared_rv, extensions = 'Buttons', 
              options = list(dom = 'Bfrtip',
                             buttons = c('csv', 'excel'))) 
```

